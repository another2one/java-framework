{% extends "../_base.html" %}

{% block main %}

<h3>user/list</h3>

<button class="btn btn-success add-user" data-toggle="modal" data-target="#myModal" style="margin:10px 0">增加</button>

<table class="table table-striped">
    <thead>
        <td>名称</td>
        <td>生日</td>
        <td>密码</td>
        <td>操作</td>
    </thead>
    {% for user in users %}
    <tr>
        <td>{{ user.name }}</td>
        <td>{{ user.initDate | date("yyyy-MM-dd HH:mm:ss", timeZone="Asia/Chongqing") }}</td>
        <td>{{ user.showPass() }}</td>
        <td>
            <a class="btn btn-sm" href="/user/{{ user.id }}">详情</a>
            <a class="btn btn-sm" href="/user/update/{{ user.id }}">修改</a>
        </td>
    </tr>
    {% endfor %}
</table>

<div class="modal" id="myModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="post" onsubmit="return adduser()">
                    <div class="form-group">
                        <label for="name">Email address</label>
                        <input type="text" name="name" class="form-control" id="name" >
                        <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
                    </div>
                    <div class="form-group">
                        <label for="pass">Password</label>
                        <input type="text" name="password" class="form-control" id="pass">
                    </div>
                    <button class="btn btn-primary">Submit</button>
                </form>
            </div>
           <!-- <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>-->
        </div>
    </div>
</div>

<script type="text/javascript">
$(function(){

});
function adduser() {
    let name = $("#name").val();
    let pass = $("#pass").val();
    if (name == "" || pass == "") {
        alert("参数错误");
        return false;
    }
    $.ajax({
        url: "/user/add",
        type: 'post',
        data: {name:$("#name").val(), password:$("#pass").val()},
        dataType: 'JSON',
        success:function(ret) {
            console.log(`%c ret == `, 'background:#41b883 ; padding:1px; color:#fff', ret);
            if (ret.code == 200) {
                bootbox.alert('操作成功', function () {
                    window.location.reload ()
                });
            } else {
                bootbox.alert(ret.msg);
            }
        }
    })
    $('#modal').modal('hide')
    return false;
}
</script>

{% endblock %}